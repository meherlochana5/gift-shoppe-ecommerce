<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout | Gift Shoppe</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; background:#fff0f5; margin:0; padding:20px; }
  .checkout-container {
    background:#fff; padding:20px; max-width:400px; margin:50px auto;
    border-radius:12px; box-shadow:0 0 15px rgba(0,0,0,0.1);
  }
  input[type=text], input[type=tel] { width:100%; padding:8px; margin-bottom:15px; border:1px solid #ccc; border-radius:5px; }
  label { display:block; margin-bottom:10px; }
  button { padding:10px 15px; border:none; border-radius:25px; cursor:pointer; font-weight:bold; background:#ff0066; color:white; transition:0.3s; }
  button:hover { background:#cc0052; }
</style>
</head>
<body>
  <div class="checkout-container">
    <h2>Checkout</h2>

    <label>Shipping Address:</label>
    <input type="text" id="address" placeholder="Enter your address">

    <label>Phone Number:</label>
    <input type="tel" id="phone" placeholder="Enter your phone number">

    <label>
      <input type="radio" name="paymentMethod" value="COD" checked> Cash on Delivery
    </label><br><br>

    <button id="place-order">Place Order</button>
  </div>

  <script>
const placeBtn = document.getElementById('place-order');

placeBtn.addEventListener('click', () => {
  const address = document.getElementById('address').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;

  if(!address || !phone){ 
    alert("Enter address and phone number!"); 
    return; 
  }

  // Get items saved for checkout
  let orders = JSON.parse(localStorage.getItem('checkoutItems')) || [];

  if(orders.length === 0){
    alert("No items in cart!"); 
    return;
  }

  // Add address, phone, payment method, date to each item
  orders = orders.map(order => ({
    ...order,
    address: address,
    phone: phone,
    paymentMethod: paymentMethod,
    date: new Date().toLocaleString()
  }));

  // Save to localStorage "placedOrders" for Profile page
  let placedOrders = JSON.parse(localStorage.getItem('placedOrders')) || [];
  placedOrders.push(...orders);
  localStorage.setItem('placedOrders', JSON.stringify(placedOrders));

  // Clear currentUser.orders & checkoutItems
  let currentUser = JSON.parse(localStorage.getItem('currentUser'));
  if(currentUser){
    currentUser.orders = [];
    localStorage.setItem('currentUser', JSON.stringify(currentUser));
  }
  localStorage.removeItem('checkoutItems');

  // Also update users array
  let users = JSON.parse(localStorage.getItem('users')) || [];
  const userIndex = users.findIndex(u => u.email === currentUser.email);
  if(userIndex !== -1){
    users[userIndex].orders = [];
    localStorage.setItem('users', JSON.stringify(users));
  }

  alert("Order placed successfully!");
  window.location.href = 'profile.html';
});
</script>

</body>
</html>
